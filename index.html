<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <title>Staff Attendance System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial,"Noto Sans Khmer",sans-serif; background:#f2f4f7; display:flex; justify-content:center; padding:20px; }
        .card { background:#fff; width:100%; max-width:400px; padding:25px; border-radius:16px; box-shadow:0 12px 30px rgba(0,0,0,.15); }
        h2 { text-align:center; color: #1e40af; margin-bottom:20px; }
        label { font-size:14px; font-weight:bold; color: #374151; }
        input, select, textarea { width:100%; padding:12px; margin:8px 0 16px; border-radius:10px; border:1px solid #d1d5db; font-size:15px; box-sizing:border-box; outline:none; transition: 0.3s; }
        input:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        textarea { display:none; height:70px; resize: none; }
        .time-box { background:#eff6ff; padding:12px; border-radius:10px; text-align:center; font-weight:bold; color: #1e40af; border: 1px dashed #bfdbfe; margin-bottom:16px; }
        button { width:100%; padding:14px; background:#2563eb; color:#fff; border:none; border-radius:12px; font-size:16px; font-weight:bold; cursor:pointer; transition: 0.3s; }
        button:hover { background:#1e40af; }
        #qrcode { display:flex; justify-content:center; margin-top:20px; }
        .found-input { border: 2px solid #10b981 !important; background-color: #f0fdf4; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“‹ áœááŸ’áá˜á¶á“á”á»á‚áŸ’á‚á›á·á€</h2>
    
    <label>áŸáŸ’áœáŸ‚á„ášá€áˆáŸ’á˜áŸ„áŸ‡á–áŸá‰</label>
    <input id="name" placeholder="áœá¶á™áˆáŸ’á˜áŸ„áŸ‡ášá”áŸáŸ‹á¢áŸ’á“á€..." list="staffList" oninput="autoFillRole()">
    <datalist id="staffList">
        <option value="á”áŸ‰áŸ‚á“ áŸáŸ†á¢á¼á“">
        <option value="á¢áŸá„ áŸáŸ’ášá¸á“á¸á“">
        <option value="á˜á»áŸ† áŸá»á•á»á“">
        <option value="á¢á¿á“ á€á¶áá¶á›áŸ‹">
        <option value="á˜á»á¹á„ áŸáŸ’ášá¸á“á¸á">
        <option value="á”áŸ‰á¼ áŸá¼áªá“">
        <option value="á‡á»á€ á áŸá“">
        <option value="ášá·á“ áŸá·ášá¸á—á¶á–">
        <option value="á”áŸŠá“áŸ‹ á†áŠá¶">
        <option value="á…áŸ†áá¶á“ áœá¶áŸá“á¶">
        <option value="áŸá»á áŸáŸ’ášá¸á–áŸá‡áŸ’áš">
        <option value="á á¼ áœá¸á áŸ’áŸá¶">
        <option value="á§á“ áŸáŸ’ášá¸ááŸ‚á">
        <option value="á›á¶á„ áŸá»á—á¶ášá¸">
        <option value="ášáŸ‰áŸá á˜á½á™áŸáŸŠá¶áŸ†á„">
        <option value="narei">
        <option value="chanthoeurn Chhoeurn">
    </datalist>

    <label>áá½á“á¶á‘á¸</label>
    <input id="role" placeholder="áá½á“á¶á‘á¸á“á¹á„á”á„áŸ’á á¶á‰á‘á¸á“áŸáŸ‡" readonly>

    <label>á”áŸ’ášá—áŸá‘áœááŸ’áá˜á¶á“</label>
    <select id="type" onchange="checkTime()">
        <option value="checkin">á…á¼á›á’áŸ’áœá¾á€á¶áš (Check-in)</option>
        <option value="checkout">á…áŸá‰á–á¸á’áŸ’áœá¾á€á¶áš (Check-out)</option>
    </select>

    <div class="time-box" id="timeBox">ğŸ•’ --:-- | ğŸ“… --/--/----</div>

    <label id="reasonLabel" style="display:none;color: #dc2626;">á˜á¼á›á áŸáá» (á™áºá/á…áŸá‰á˜á»á“)</label>
    <textarea id="reason" placeholder="áŸá¼á˜á”á‰áŸ’á‡á¶á€áŸ‹á˜á¼á›á áŸáá»..."></textarea>

    <button onclick="processAttendance()">á•áŸ’á‰á¾áœááŸ’áá˜á¶á“á‘áŸ… Telegram</button>
    <div id="qrcode"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const TELEGRAM_BOT_TOKEN = "8242266919:AAGE6uMJ_-UvM-3KBZkJVFhJyTLvcTVW5tQ";
const TELEGRAM_CHAT_ID = "-1005254412614";
const OFFICIAL_IN = "07:15";
const OFFICIAL_OUT = "17:15";

// á‘á·á“áŸ’á“á“áŸá™á”á»á‚áŸ’á‚á›á·á€áŠáŸ‚á›áŠá€áŸáŸ’ášá„áŸ‹á…áŸá‰á–á¸ášá¼á”á—á¶á–
const staffDatabase = {
    "á”áŸ‰áŸ‚á“ áŸáŸ†á¢á¼á“": "á“á¶á™á€",
    "á¢áŸá„ áŸáŸ’ášá¸á“á¸á“": "á¢áŸ’á“á€á•áŸ’áá›áŸ‹á–áŸááŸŒá˜á¶á“",
    "á˜á»áŸ† áŸá»á•á»á“": "á¢áŸ’á“á€á¢á“á¶á˜áŸá™",
    "á¢áŸ€á„ á€á¶áá¶á›áŸ‹": "á‚áŸ’ášá¼á‘á¸áŸ¢",
    "á˜áŸ‰á¹á„ áŸáŸ’ášá¸á“á¸á": "á‚áŸ’ášá¼á‘á¸áŸ¤ á‘á¸áŸ¥",
    "á”áŸ‰á¼ áŸá»áªá“": "á‚áŸ’ášá¼á‘á¸áŸ£",
    "á‡á»á€ á áŸá“": "á˜ááŸ’ááŸá™áŸ’á™ááŸ’á–áŸáŸ‹",
    "ášá·á“ áŸá·ášá¸á—á¶á–": "á˜ááŸ’ááŸá™áŸ’á™á˜á’áŸ’á™á˜",
    "á”áŸŠá“áŸ‹ á†áŠá¶": "á˜ááŸ’ááŸá™áŸ’á™á‘á¶á”",
    "á…áŸ†áá¶á“ áœá¶áŸá“á¶": "found1",
    "áŸá»á áŸáŸ’ášá¸á–áŸá‡áŸ’áš": "nursery",
    "á á¼ áœá¸á áŸ’áŸá¶": "TA nursery",
    "á§á“ áŸáŸ’ášá¸ááŸ‚á": "level1",
    "á›á¶á„ áŸá»á—á¶ášá¸": "IT",
    "ášáŸ‰áŸá á˜á½á™áŸáŸŠá¶áŸ†á„": "á—á¶áŸá¶á…á·á“",
    "narei": "found2",
    "chanthoeurn Chhoeurn": "IT"
};

function autoFillRole() {
    const nameInput = document.getElementById("name");
    const roleInput = document.getElementById("role");
    const val = nameInput.value.trim();

    if (staffDatabase[val]) {
        roleInput.value = staffDatabase[val];
        nameInput.classList.add("found-input");
    } else {
        roleInput.value = "";
        nameInput.classList.remove("found-input");
    }
}

function getNow(){
    const now = new Date();
    const time = now.toTimeString().slice(0,5);
    const date = now.toLocaleDateString("en-GB");
    return {time,date};
}

function checkTime(){
    const {time} = getNow();
    const type = document.getElementById("type").value;
    const reason = document.getElementById("reason");
    const label = document.getElementById("reasonLabel");
    let needReason = false;
    
    if(type==="checkin" && time > OFFICIAL_IN) needReason=true;
    if(type==="checkout" && time < OFFICIAL_OUT) needReason=true;
    
    reason.style.display = needReason ? "block" : "none";
    label.style.display = needReason ? "block" : "none";
}

function updateTime(){
    const {time,date} = getNow();
    document.getElementById("timeBox").innerText = `ğŸ•’ ${time} | ğŸ“… ${date}`;
    checkTime();
}
updateTime();
setInterval(updateTime, 60000);

async function sendToTelegram(message) {
    const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
    try {
        const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                chat_id: TELEGRAM_CHAT_ID,
                text: message,
                parse_mode: "HTML"
            })
        });
        return response.ok;
    } catch (error) { return false; }
}

async function processAttendance() {
    const name = document.getElementById("name").value;
    const role = document.getElementById("role").value;
    const type = document.getElementById("type").value;
    const reason = document.getElementById("reason").value;
    const {time, date} = getNow();

    if(!name || !role){
        alert("áŸá¼á˜áœá¶á™áˆáŸ’á˜áŸ„áŸ‡á±áŸ’á™á”á¶á“ááŸ’ášá¹á˜ááŸ’ášá¼áœá€áŸ’á“á»á„á”á‰áŸ’á‡á¸!");
        return;
    }

    let msg = `ğŸ“‹ <b>ášá”á¶á™á€á¶ášááŸáœááŸ’áá˜á¶á“</b>\n\n`;
    msg += `ğŸ‘¤ <b>áˆáŸ’á˜áŸ„áŸ‡:</b> ${name}\n`;
    msg += `ğŸ’¼ <b>áá½á“á¶á‘á¸:</b> ${role}\n`;
    msg += `ğŸ“Š <b>áŸáŸ’áá¶á“á—á¶á–:</b> ${type === 'checkin' ? 'ğŸŸ¢ á…á¼á›á’áŸ’áœá¾á€á¶áš' : 'ğŸ”´ á…áŸá‰á–á¸á’áŸ’áœá¾á€á¶áš'}\n`;
    msg += `ğŸ“… <b>á€á¶á›á”ášá·á…áŸ’á†áŸá‘:</b> ${date}\n`;
    msg += `ğŸ•’ <b>á˜áŸ‰áŸ„á„:</b> ${time}`;
    if(reason) msg += `\nâš ï¸ <b>á˜á¼á›á áŸáá»:</b> ${reason}`;

    document.getElementById("qrcode").innerHTML="";
    new QRCode(document.getElementById("qrcode"), {
        text: `Staff: ${name}\nRole: ${role}\nTime: ${time}\nStatus: ${type}`,
        width: 150,
        height: 150
    });

    const success = await sendToTelegram(msg);
    if(success) alert("âœ… ášá½á…ášá¶á›áŸ‹! á‘á·á“áŸ’á“á“áŸá™ááŸ’ášá¼áœá”á¶á“á•áŸ’á‰á¾á‘áŸ…á€á¶á“áŸ‹ TelegramáŸ”");
    else alert("âŒ á”ášá¶á‡áŸá™! áŸá¼á˜á–á·á“á·ááŸ’á™á¢áŸŠá¸á“á’áºáá·áášá”áŸáŸ‹á¢áŸ’á“á€áŸ”");
}
</script>
</body>
</html>


